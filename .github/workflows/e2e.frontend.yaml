name: e2e:frontend
on:
  pull_request:
    # paths:
    #   - 'frontend/**'
jobs:
  e2e:
    runs-on: ubuntu-latest
    steps:
      - name: Dump GitHub context
        env:
          GITHUB_CONTEXT: ${{ toJson(github) }}
        run: |
          echo "$GITHUB_CONTEXT"
      - name: Checkout
        uses: actions/checkout@v4
      - name: Build static frontend
        run: |
          cd frontend
          yarn install --immutable
          yarn build
      - name: Start Unleash test instance
        run: |
          docker compose -f .github/docker-compose.test.yml up -d --wait -t 90
        env:
          FRONTEND_TEST_LICENSE: ${{ secrets.FRONTEND_TEST_LICENSE }}
      - name: Run Cypress
        uses: cypress-io/github-action@v6
        with:
          working-directory: frontend
          env: AUTH_USER=admin,AUTH_PASSWORD=unleash4all
          config: baseUrl=http://localhost:3000
          spec: |
            cypress/integration/feature/feature.spec.ts
            cypress/integration/groups/groups.spec.ts
            cypress/integration/projects/access.spec.ts
            cypress/integration/segments/segments.spec.ts
            cypress/integration/login/login.spec.ts
          install-command: yarn --immutable
